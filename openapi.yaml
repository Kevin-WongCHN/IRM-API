openapi: 3.0.0
info:
  title: IRM Platform API
  description: 需求管理平台 (IRM-Platform) 后端接口定义（项目管理-仅展示+编辑）
  version: 1.0.0
servers:
  - url: http://localhost:8080
    description: 本地开发服务器

tags:
  - name: 需求定义
    description: 需求的增删改查接口（原有，保留）
  - name: 项目管理
    description: 项目管理相关接口（仅展示/编辑/保存）
  - name: 基线管理
    description: 基线管理相关接口
  - name: 在线评审
    description: 在线评审相关接口
  - name: 需求确认
    description: 需求确认相关接口
  - name: 需求验证
    description: 需求验证相关接口
  - name: 变更管理
    description: 变更管理相关接口

paths:
  /api/requirements:
    get:
      tags: [需求定义]
      summary: 获取需求列表
      parameters:
        - name: documentId
          in: query
          required: false
          schema:
            type: string
      responses:
        '200':
          description: 成功获取需求列表
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Requirement'
    post:
      tags: [需求定义]
      summary: 保存单个需求
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Requirement'
      responses:
        '200':
          description: 需求保存成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Requirement'

  /api/requirements/batch:
    post:
      tags: [需求定义]
      summary: 批量保存需求
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: array
              items:
                $ref: '#/components/schemas/Requirement'
      responses:
        '200':
          description: 批量保存成功

  /api/requirements/{id}:
    delete:
      tags: [需求定义]
      summary: 删除指定需求
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: 需求删除成功

  /api/config/{id}:
    get:
      tags: [需求定义]
      summary: 获取项目配置
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: 成功获取配置
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProjectConfig'

  /api/config:
    post:
      tags: [需求定义]
      summary: 保存项目配置
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ProjectConfig'
      responses:
        '200':
          description: 配置保存成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProjectConfig'

  # ------------------------------
  # 项目管理核心接口
  # ------------------------------

  /api/project/save:
    post:
      tags: [项目管理]
      summary: 保存项目基本信息（新增/编辑）
      description: 页面“保存”按钮调用，支持新增/编辑，提交含 tempId
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                tempId:
                  type: string
                  description: 前端生成的临时ID
                project_name:
                  type: string
                project_code:
                  type: string
                leader:
                  type: string
                department:
                  type: string
                project_scale:
                  type: string
                  enum: [小型, 中型, 大型, 超大型]
                project_level:
                  type: string
                  enum: [P0紧急, P1重要, P2常规, P3低优先级]
                start_time:
                  type: string
                  format: date
                end_time:
                  type: string
                  format: date
              required:
                - tempId
                - project_name
                - project_code
                - leader
                - department
                - project_scale
                - project_level
                - start_time
                - end_time
            example:
              tempId: "temp_123456"
              project_name: "智能需求管理系统V2.0"
              project_code: "PRJ-202401"
              leader: "李四"
              department: "研发部"
              project_scale: "中型"
              project_level: "P1重要"
              start_time: "2024-02-01"
              end_time: "2024-12-31"
      responses:
        '200':
          description: 项目保存成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Project'
        '400':
          description: 参数错误（必填字段为空/格式错误）
        '500':
          description: 服务器内部错误

  ## 2. 获取单个项目（编辑回显）- 匹配页面初始化
  /api/project/{projectId}:
    get:
      tags: [项目管理]
      summary: 获取单个项目信息（编辑回显）
      description: 页面初始化加载项目详情，用于展示和编辑回显
      parameters:
        - name: projectId
          in: path
          required: true
          schema:
            type: integer
            format: int64
          example: 1
      responses:
        '200':
          description: 成功获取项目信息
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Project'
        '404':
          description: 项目不存在
        '500':
          description: 服务器内部错误
 
  # ------------------------------
  # 以下项目管理子模块
  # ------------------------------
  /api/project/roles:
    get:
      tags: [项目管理]
      summary: 获取项目角色列表
      parameters:
        - name: project_id
          in: query
          required: true
          schema:
            type: integer
            format: int64
      responses:
        '200':
          description: 成功获取角色列表
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Role'

  /api/project/role/create:
    post:
      tags: [项目管理]
      summary: 新增项目角色
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RoleCreate'
      responses:
        '200':
          description: 角色新增成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Role'

  /api/project/role/{roleId}:
    put:
      tags: [项目管理]
      summary: 更新项目角色
      parameters:
        - name: roleId
          in: path
          required: true
          schema:
            type: integer
            format: int64
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RoleUpdate'
      responses:
        '200':
          description: 角色更新成功
    delete:
      tags: [项目管理]
      summary: 删除项目角色
      parameters:
        - name: roleId
          in: path
          required: true
          schema:
            type: integer
            format: int64
        - name: project_id
          in: query
          required: true
          schema:
            type: integer
            format: int64
      responses:
        '200':
          description: 角色删除成功

  /api/project/roles/saveAll:
    post:
      tags: [项目管理]
      summary: 批量保存项目角色
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                project_id:
                  type: integer
                  format: int64
                roles:
                  type: array
                  items:
                    $ref: '#/components/schemas/RoleBatchItem'
              required:
                - project_id
                - roles
      responses:
        '200':
          description: 批量保存成功

  /api/project/members:
    get:
      tags: [项目管理]
      summary: 获取项目成员列表
      parameters:
        - name: project_id
          in: query
          required: false
          schema:
            type: integer
            format: int64
      responses:
        '200':
          description: 成功获取成员列表
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Member'

  /api/project/member/create:
    post:
      tags: [项目管理]
      summary: 新增项目成员
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/MemberCreate'
      responses:
        '200':
          description: 成员新增成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Member'

  /api/project/member/{memberId}:
    put:
      tags: [项目管理]
      summary: 更新项目成员
      parameters:
        - name: memberId
          in: path
          required: true
          schema:
            type: integer
            format: int64
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/MemberUpdate'
      responses:
        '200':
          description: 成员更新成功
    delete:
      tags: [项目管理]
      summary: 删除项目成员
      parameters:
        - name: memberId
          in: path
          required: true
          schema:
            type: integer
            format: int64
      responses:
        '200':
          description: 成员删除成功

  /api/project/members/search:
    get:
      tags: [项目管理]
      summary: 搜索项目成员
      parameters:
        - name: project_id
          in: query
          required: false
          schema:
            type: integer
            format: int64
        - name: keyword
          in: query
          required: true
          schema:
            type: string
      responses:
        '200':
          description: 搜索成功
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Member'

  /api/project/folders:
    get:
      tags: [项目管理]
      summary: 获取项目文件夹列表
      parameters:
        - name: project_id
          in: query
          required: true
          schema:
            type: integer
            format: int64
      responses:
        '200':
          description: 成功获取文件夹列表
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Folder'

  /api/project/folder/create:
    post:
      tags: [项目管理]
      summary: 新增项目文件夹
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/FolderCreate'
      responses:
        '200':
          description: 文件夹新增成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Folder'

  /api/project/folder/{folderId}:
    put:
      tags: [项目管理]
      summary: 更新项目文件夹
      parameters:
        - name: folderId
          in: path
          required: true
          schema:
            type: integer
            format: int64
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/FolderUpdate'
      responses:
        '200':
          description: 文件夹更新成功
    delete:
      tags: [项目管理]
      summary: 删除项目文件夹
      parameters:
        - name: folderId
          in: path
          required: true
          schema:
            type: integer
            format: int64
        - name: project_id
          in: query
          required: true
          schema:
            type: integer
            format: int64
      responses:
        '200':
          description: 文件夹删除成功

  /api/project/documents:
    get:
      tags: [项目管理]
      summary: 获取项目文档列表
      parameters:
        - name: project_id
          in: query
          required: true
          schema:
            type: integer
            format: int64
      responses:
        '200':
          description: 成功获取文档列表
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Document'

  /api/project/document/create:
    post:
      tags: [项目管理]
      summary: 新增项目文档
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/DocumentCreate'
      responses:
        '200':
          description: 文档新增成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Document'

  /api/project/document/{documentId}:
    put:
      tags: [项目管理]
      summary: 更新项目文档
      parameters:
        - name: documentId
          in: path
          required: true
          schema:
            type: integer
            format: int64
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/DocumentUpdate'
      responses:
        '200':
          description: 文档更新成功
    delete:
      tags: [项目管理]
      summary: 删除项目文档
      parameters:
        - name: documentId
          in: path
          required: true
          schema:
            type: integer
            format: int64
        - name: project_id
          in: query
          required: true
          schema:
            type: integer
            format: int64
      responses:
        '200':
          description: 文档删除成功

  /api/project/document/{documentId}/download:
    put:
      tags: [项目管理]
      summary: 更新文档下载次数
      parameters:
        - name: documentId
          in: path
          required: true
          schema:
            type: integer
            format: int64
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                download_count:
                  type: integer
              required:
                - download_count
      responses:
        '200':
          description: 下载次数更新成功

components:
  schemas:
    Requirement:
      type: object
      properties:
        id:
          type: string
        parentId:
          type: string
          nullable: true
        numId:
          type: string
        type:
          type: string
          enum: [heading, text]
        documentId:
          type: string
        content:
          type: string
        attributes:
          type: string
      example:
        id: "srs-t1"
        parentId: "srs-h1"
        numId: "1.1"
        type: "text"
        documentId: "file-1"
        content: "智能座舱系统应集成语音识别功能。"
        attributes: "[{\"name\":\"状态\",\"value\":\"进行中\"}]"

    ProjectConfig:
      type: object
      properties:
        id:
          type: string
        docConfig:
          type: string
        customTypes:
          type: string
        projectMembers:
          type: string
      example:
        id: "default"
        docConfig: "{\"attributes\":[{\"name\":\"文档名称\",\"value\":\"SRS\"}]}"
        projectMembers: "[{\"id\":\"m1\",\"name\":\"Kevin Wu\"}]"
        customTypes: "[{\"id\":\"type-status\",\"name\":\"进行状态\"}]"

    # ------------------------------
    # 项目管理核心模型（与页面代码完全匹配）
    # ------------------------------
    Project:
      type: object
      properties:
        project_id:
          type: integer
          format: int64
          description: 项目ID
        project_name:
          type: string
          description: 项目名称
        project_code:
          type: string
          description: 项目代号
        leader:
          type: string
          description: 负责人
        department:
          type: string
          description: 所属部门
        project_scale:
          type: string
          enum: [小型, 中型, 大型, 超大型]
          description: 项目规模
        project_level:
          type: string
          enum: [P0紧急, P1重要, P2常规, P3低优先级]
          description: 项目等级
        start_time:
          type: string
          format: date
          description: 开始时间
        end_time:
          type: string
          format: date
          description: 结束时间
      example:
        project_id: 1
        project_name: "示例项目A"
        project_code: "PRJ-001"
        leader: "张三"
        department: "研发部"
        project_scale: "中型"
        project_level: "P1重要"
        start_time: "2023-01-01"
        end_time: "2023-12-31"

    Role:
      type: object
      properties:
        role_id:
          type: integer
          format: int64
        role_name:
          type: string
        role_description:
          type: string
        members:
          type: array
          items:
            type: object
            properties:
              member_id:
                type: integer
                format: int64
              name:
                type: string
              contact:
                type: string
      example:
        role_id: 1
        role_name: "项目负责人"
        role_description: "负责项目总体推进"
        members:
          - member_id: 1
            name: "测试用户1"
            contact: "13800138001"

    RoleCreate:
      type: object
      properties:
        tempId:
          type: string
        project_id:
          type: integer
          format: int64
        role_name:
          type: string
        role_description:
          type: string
        member_ids:
          type: string
        member_names:
          type: string
      required:
        - project_id
        - role_name

    RoleUpdate:
      type: object
      properties:
        role_name:
          type: string
        role_description:
          type: string
        member_ids:
          type: string
        member_names:
          type: string

    RoleBatchItem:
      type: object
      properties:
        role_id:
          type: integer
          format: int64
        role_name:
          type: string
        role_description:
          type: string
        member_ids:
          type: string
        member_names:
          type: string

    Member:
      type: object
      properties:
        member_id:
          type: integer
          format: int64
        member_name:
          type: string
        contact:
          type: string
        member_email:
          type: string
          format: email
        department:
          type: string
        position:
          type: string
      example:
        member_id: 101
        member_name: "张三"
        contact: "13800138000"
        member_email: "zhangsan@xxx.com"
        department: "产品部"
        position: "产品经理"

    MemberCreate:
      type: object
      properties:
        tempId:
          type: string
        member_name:
          type: string
        contact:
          type: string
        member_email:
          type: string
          format: email
        department:
          type: string
        position:
          type: string
      required:
        - member_name
        - contact
        - department
        - position

    MemberUpdate:
      type: object
      properties:
        member_name:
          type: string
        contact:
          type: string
        member_email:
          type: string
          format: email
        department:
          type: string
        position:
          type: string

    Folder:
      type: object
      properties:
        folder_id:
          type: integer
          format: int64
        project_id:
          type: integer
          format: int64
        folder_name:
          type: string
      example:
        folder_id: 601
        project_id: 301
        folder_name: "需求文档"

    FolderCreate:
      type: object
      properties:
        tempId:
          type: string
        project_id:
          type: integer
          format: int64
        folder_name:
          type: string
      required:
        - project_id
        - folder_name

    FolderUpdate:
      type: object
      properties:
        folder_name:
          type: string

    Document:
      type: object
      properties:
        document_id:
          type: integer
          format: int64
        project_id:
          type: integer
          format: int64
        document_name:
          type: string
        document_attr:
          type: object
        folder_id:
          type: integer
          format: int64
        document_path:
          type: string
        uploader_id:
          type: integer
          format: int64
        upload_time:
          type: string
          format: date-time
        download_count:
          type: integer
        document_status:
          type: string
      example:
        document_id: 501
        project_id: 301
        document_name: "智能需求管理系统V2.0需求规格说明书.pdf"
        document_attr:
          格式: "pdf"
          大小: "2.5MB"
          页数: 32
        folder_id: 601
        document_path: "/project/301/docs/req_spec_V2.0.pdf"
        uploader_id: 101
        upload_time: "2024-01-20 15:30:00"
        download_count: 18
        document_status: "在用"

    DocumentCreate:
      type: object
      properties:
        tempId:
          type: string
        project_id:
          type: integer
          format: int64
        document_name:
          type: string
        document_attr:
          type: object
        folder_id:
          type: integer
          format: int64
        folderTempId:
          type: string
        document_path:
          type: string
        uploader_id:
          type: integer
          format: int64
        upload_time:
          type: string
          format: date-time
        download_count:
          type: integer
        document_status:
          type: string
      required:
        - project_id
        - document_name
        - folder_id
        - document_path
        - uploader_id
        - upload_time

    DocumentUpdate:
      type: object
      properties:
        document_name:
          type: string
        document_attr:
          type: object
        document_path:
          type: string
        document_status:
          type: string
